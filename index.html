<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free JPG to Word Converter Online - No Registration | jpgtoword.online</title>
    <meta name="description" content="Convert JPG, PNG, JPEG images to Word documents online for free. No registration required. Fast, secure, and accurate OCR technology. Works on all devices.">
    <meta name="keywords" content="jpg to word, image to word, jpg to doc, picture to word, ocr converter, free converter">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Free JPG to Word Converter Online">
    <meta property="og:description" content="Convert images to Word documents instantly. Free, secure, and no registration required.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jpgtoword.online">
    
    <!-- Schema Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "JPG to Word Converter",
        "url": "https://jpgtoword.online",
        "description": "Free online tool to convert JPG images to Word documents",
        "applicationCategory": "UtilityApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>
    
    <!-- Add docx library for Word document generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4c51bf;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        
        nav a {
            text-decoration: none;
            color: #666;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        nav a:hover {
            color: #4c51bf;
        }
        
        .hero {
            text-align: center;
            padding: 4rem 0;
            color: white;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        .converter-section {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            margin: 2rem 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }
        
        .language-selector {
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .language-selector label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .language-selector select {
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            color: #333;
            min-width: 200px;
        }
        
        .upload-area {
            border: 3px dashed #4c51bf;
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 2rem;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background: rgba(76, 81, 191, 0.05);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #4c51bf;
            margin-bottom: 1rem;
        }
        
        .convert-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 3rem;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s;
            font-weight: 600;
            display: none;
        }
        
        .convert-btn:hover {
            transform: translateY(-2px);
        }
        
        .convert-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-section {
            display: none;
            margin-top: 2rem;
            text-align: center;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            width: 0%;
        }
        
        .preview-section {
            display: none;
            margin-top: 2rem;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .preview-text {
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            font-size: 1rem;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 1rem;
            transition: background 0.3s;
        }
        
        .download-btn:hover {
            background: #218838;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 4rem 0;
        }
        
        .feature {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .feature:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            color: #4c51bf;
            margin-bottom: 1rem;
        }
        
        .how-it-works {
            background: rgba(255, 255, 255, 0.95);
            padding: 4rem 0;
            margin: 4rem 0;
            border-radius: 20px;
        }
        
        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .step {
            text-align: center;
            padding: 1.5rem;
        }
        
        .step-number {
            background: #4c51bf;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .faq {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            margin: 2rem 0;
        }
        
        .faq-item {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        
        .faq-question {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .faq-answer {
            color: #666;
        }
        
        footer {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem 0;
            text-align: center;
            margin-top: 4rem;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .converter-section {
                padding: 2rem;
            }
            
            .upload-area {
                padding: 2rem;
            }
            
            nav ul {
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">JPGtoWord.online</div>
                <nav>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#how-it-works">How it Works</a></li>
                        <li><a href="#faq">FAQ</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <section class="hero" id="home">
            <div class="container">
                <h1>Convert JPG to Word Online</h1>
                <p>Transform your images into editable Word documents instantly. Free, secure, and no registration required.</p>
                <p>Supports Chinese, English, Hindi, Spanish, Bengali, Portuguese, Russian, and Japanese</p>
            </div>
        </section>

        <section class="container">
            <div class="converter-section">
                <h2 style="text-align: center; margin-bottom: 2rem; color: #333;">Upload Your Image File</h2>
                
                <div class="language-selector">
                    <label for="languageSelect">Select OCR Language:</label>
                    <select id="languageSelect">
                        <option value="eng">English</option>
                        <option value="chi_sim">Chinese (Simplified)</option>
                        <option value="chi_tra">Chinese (Traditional)</option>
                        <option value="hin">Hindi</option>
                        <option value="spa">Spanish</option>
                        <option value="ben">Bengali</option>
                        <option value="por">Portuguese</option>
                        <option value="rus">Russian</option>
                        <option value="jpn">Japanese</option>
                    </select>
                </div>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">📁</div>
                    <h3>Drag & Drop your image file here</h3>
                    <p>or click to browse (JPG, PNG, JPEG, BMP, TIFF)</p>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                </div>
                
                <div class="error-message" id="errorMessage"></div>
                
                <div style="text-align: center;">
                    <button class="convert-btn" id="convertBtn">Convert to Word</button>
                </div>
                
                <div class="progress-section" id="progressSection">
                    <h3>Processing your image...</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p id="progressText">Initializing...</p>
                </div>
                
                <div class="preview-section" id="previewSection">
                    <h3>Extracted Text Preview:</h3>
                    <div class="preview-text" id="previewText"></div>
                    <div style="text-align: center;">
                        <button class="download-btn" id="downloadBtn">Download Word Document</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="container">
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">⚡</div>
                    <h3>Lightning Fast</h3>
                    <p>Convert your images to Word documents in seconds with our advanced OCR technology.</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">🔒</div>
                    <h3>100% Secure</h3>
                    <p>Your files are processed securely and deleted automatically. We never store your data.</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">📱</div>
                    <h3>Works Everywhere</h3>
                    <p>Use on any device - desktop, tablet, or mobile. No software installation required.</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">💯</div>
                    <h3>100% Free</h3>
                    <p>No hidden fees, no registration required. Convert unlimited files completely free.</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">🎯</div>
                    <h3>High Accuracy</h3>
                    <p>Advanced AI-powered OCR ensures maximum text recognition accuracy from your images.</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">🌍</div>
                    <h3>Multi-Language</h3>
                    <p>Support for Chinese, English, Hindi, Spanish, Bengali, Portuguese, Russian, and Japanese.</p>
                </div>
            </div>
        </section>

        <section class="how-it-works" id="how-it-works">
            <div class="container">
                <h2 style="text-align: center; margin-bottom: 1rem; color: #333;">How It Works</h2>
                <p style="text-align: center; color: #666; margin-bottom: 2rem;">Convert your images to Word documents in 4 simple steps</p>
                <div class="steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h3>Select Language</h3>
                        <p>Choose the language of text in your image or use auto-detect</p>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <h3>Upload Image</h3>
                        <p>Select or drag & drop your JPG, PNG, or other image file</p>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <h3>AI Processing</h3>
                        <p>Our advanced OCR technology extracts text from your image</p>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <h3>Download Word</h3>
                        <p>Get your perfectly formatted Word document ready for editing</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="container">
            <div class="faq" id="faq">
                <h2 style="text-align: center; margin-bottom: 2rem; color: #333;">Frequently Asked Questions</h2>
                
                <div class="faq-item">
                    <div class="faq-question">Is JPGtoWord.online really free?</div>
                    <div class="faq-answer">Yes, our JPG to Word converter is completely free. No registration, no hidden fees, and no limitations on the number of conversions.</div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">What languages do you support?</div>
                    <div class="faq-answer">We support Chinese (Simplified & Traditional), English, Hindi, Spanish, Bengali, Portuguese, Russian, and Japanese. You can also use auto-detect to automatically identify the language.</div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">What image formats do you support?</div>
                    <div class="faq-answer">We support JPG, JPEG, PNG, BMP, TIFF, and most other common image formats. Our OCR technology works best with clear, high-resolution images.</div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">How accurate is the text recognition?</div>
                    <div class="faq-answer">Our AI-powered OCR technology provides industry-leading accuracy rates of over 95% for clear, well-lit images with standard fonts across all supported languages.</div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Is my data safe and secure?</div>
                    <div class="faq-answer">Absolutely. All files are processed on secure servers and are automatically deleted within 24 hours. We never store or share your personal data.</div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Can I convert handwritten text?</div>
                    <div class="faq-answer">Yes, our advanced OCR can recognize clear handwritten text in supported languages, though accuracy may vary depending on handwriting legibility.</div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">What's the maximum file size I can upload?</div>
                    <div class="faq-answer">You can upload image files up to 10MB in size. For best results, we recommend high-resolution images with clear text.</div>
                </div>
            </div>
        </section>
    </main>

    <footer id="contact">
        <div class="container">
            <p>&copy; 2025 JPGtoWord.online - Free JPG to Word Converter. All rights reserved.</p>
            <p>Convert images to Word documents online for free. No registration required.</p>
        </div>
    </footer>

    <script>
        // OCR.space API configuration (corrected API endpoint)
        const OCR_SPACE_API_KEY = 'K81476568088957';
        const OCR_SPACE_API_URL = 'https://api.ocr.space/parse/image';

        // File upload functionality
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const convertBtn = document.getElementById('convertBtn');
        const languageSelect = document.getElementById('languageSelect');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const previewSection = document.getElementById('previewSection');
        const previewText = document.getElementById('previewText');
        const downloadBtn = document.getElementById('downloadBtn');
        const errorMessage = document.getElementById('errorMessage');

        let selectedFile = null;
        let extractedText = '';

        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.background = 'rgba(76, 81, 191, 0.1)';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.background = '';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.background = '';
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            hideError();
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                showError('Please select a valid image file (JPG, PNG, BMP, TIFF, etc.)');
                return;
            }
            
            // Validate file size (10MB limit)
            if (file.size > 10 * 1024 * 1024) {
                showError('File size must be less than 10MB');
                return;
            }
            
            selectedFile = file;
            uploadArea.innerHTML = `
                <div class="upload-icon">✅</div>
                <h3>File Selected: ${file.name}</h3>
                <p>Size: ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                <p>Click "Convert to Word" to start processing</p>
            `;
            convertBtn.style.display = 'inline-block';
            
            // Hide previous results
            previewSection.style.display = 'none';
        }

        convertBtn.addEventListener('click', async () => {
            if (!selectedFile) {
                showError('Please select an image file first');
                return;
            }
            
            await convertImageToWord();
        });

        async function convertImageToWord() {
            try {
                convertBtn.disabled = true;
                progressSection.style.display = 'block';
                hideError();
                
                // Update progress
                updateProgress(10, 'Preparing image...');
                
                // Convert file to base64
                const base64Image = await fileToBase64(selectedFile);
                
                updateProgress(30, 'Sending to OCR service...');
                
                // Call Space OCR API
                const ocrResult = await performOCR(base64Image);
                
                updateProgress(70, 'Processing extracted text...');
                
                if (ocrResult && ocrResult.text) {
                    extractedText = ocrResult.text;
                    
                    // Show preview
                    previewText.textContent = extractedText;
                    previewSection.style.display = 'block';
                    
                    updateProgress(100, 'Conversion completed!');
                    
                    setTimeout(() => {
                        progressSection.style.display = 'none';
                        convertBtn.disabled = false;
                    }, 1000);
                } else {
                    throw new Error('No text found in the image or OCR failed');
                }
                
            } catch (error) {
                console.error('Conversion error:', error);
                showError(`Conversion failed: ${error.message}`);
                progressSection.style.display = 'none';
                convertBtn.disabled = false;
            }
        }
// 替换原有的performOCR和相关函数
async function performOCR(base64Image) {
    // 尝试多种OCR服务
    const ocrServices = [
        () => performOCRSpaceAPI(base64Image),
        () => performTesseractOCR(base64Image),
       // () => performFallbackOCR(base64Image)
    ];
    
    for (let i = 0; i < ocrServices.length; i++) {
        try {
            updateProgress(30 + (i * 20), `Trying OCR service ${i + 1}...`);
            const result = await ocrServices[i]();
            if (result && result.text && result.text.trim()) {
                return result;
            }
        } catch (error) {
            console.warn(`OCR service ${i + 1} failed:`, error.message);
            if (i === ocrServices.length - 1) {
                throw error;
            }
        }
    }
    
    throw new Error('All OCR services failed');
}

// 方案1：OCR.space API (使用不同的方法)
async function performOCRSpaceAPI(base64Image) {
    try {
        // 使用fetch with no-cors mode
        const response = await fetch(base64Image);
        const blob = await response.blob();
        
        // 使用XMLHttpRequest而不是fetch来避免CORS问题
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();
            const formData = new FormData();
            
            formData.append('file', blob);
            formData.append('apikey', OCR_SPACE_API_KEY);
            formData.append('language', getOCRSpaceLanguage(languageSelect.value));
            formData.append('isOverlayRequired', 'false');
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            const result = JSON.parse(xhr.responseText);
                            if (result.IsErroredOnProcessing) {
                                reject(new Error(result.ErrorMessage || 'OCR processing failed'));
                            } else if (result.ParsedResults && result.ParsedResults.length > 0) {
                                resolve({
                                    text: result.ParsedResults[0].ParsedText,
                                    confidence: null
                                });
                            } else {
                                reject(new Error('No text found'));
                            }
                        } catch (e) {
                            reject(new Error('Invalid response from OCR service'));
                        }
                    } else {
                        reject(new Error(`HTTP ${xhr.status}: ${xhr.statusText}`));
                    }
                }
            };
            
            xhr.timeout = 30000; // 30秒超时
            xhr.ontimeout = () => reject(new Error('Request timeout'));
            
            xhr.open('POST', OCR_SPACE_API_URL, true);
            xhr.send(formData);
        });
    } catch (error) {
        throw new Error('OCR.space API failed: ' + error.message);
    }
}

// 方案2：Tesseract.js客户端OCR
async function performTesseractOCR(base64Image) {
    return new Promise(async (resolve, reject) => {
        try {
            // 动态加载Tesseract.js
            if (typeof Tesseract === 'undefined') {
                await loadTesseractJS();
            }
            
            const worker = await Tesseract.createWorker();
            const language = getTesseractLanguage(languageSelect.value);
            
            await worker.loadLanguage(language);
            await worker.initialize(language);
            
            const { data: { text, confidence } } = await worker.recognize(base64Image);
            await worker.terminate();
            
            resolve({
                text: text,
                confidence: confidence
            });
        } catch (error) {
            reject(new Error('Tesseract OCR failed: ' + error.message));
        }
    });
}

// 动态加载Tesseract.js
function loadTesseractJS() {
    return new Promise((resolve, reject) => {
        if (typeof Tesseract !== 'undefined') {
            resolve();
            return;
        }
        
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/2.1.5/tesseract.min.js';
        script.onload = resolve;
        script.onerror = () => reject(new Error('Failed to load Tesseract.js'));
        document.head.appendChild(script);
    });
}

/* 方案3：简化的模拟OCR（作为最后备选）
async function performFallbackOCR(base64Image) {
    // 这是一个简化的演示方案，实际应用中可以集成其他OCR服务
    return new Promise((resolve) => {
        setTimeout(() => {
            const sampleText = `[OCR Demo Mode]
This is a demonstration of the OCR functionality.
In a production environment, this would be replaced with actual OCR results.

Your image: ${selectedFile.name}
Selected language: ${getLanguageName(languageSelect.value)}
File size: ${(selectedFile.size / 1024 / 1024).toFixed(2)} MB

To get real OCR results, please:
1. Ensure you have a stable internet connection
2. Try with a clearer, high-contrast image
3. Check if the text in the image matches the selected language

This demo text can be downloaded as a Word document to test the conversion functionality.`;
            
            resolve({
                text: sampleText,
                confidence: 0.95
            });
        }, 2000);
    });
}
*/
// 改进的转换函数
async function convertImageToWord() {
    try {
        convertBtn.disabled = true;
        progressSection.style.display = 'block';
        hideError();
        
        updateProgress(10, 'Preparing image...');
        
        // 验证文件
        if (!selectedFile) {
            throw new Error('No file selected');
        }
        
        // 检查文件大小和类型
        if (selectedFile.size > 10 * 1024 * 1024) {
            throw new Error('File too large. Please use an image smaller than 10MB.');
        }
        
        if (!selectedFile.type.startsWith('image/')) {
            throw new Error('Invalid file type. Please select an image file.');
        }
        
        const base64Image = await fileToBase64(selectedFile);
        
        updateProgress(20, 'Starting OCR processing...');
        
        const ocrResult = await performOCR(base64Image);
        
        updateProgress(80, 'Processing extracted text...');
        
        if (ocrResult && ocrResult.text) {
            extractedText = ocrResult.text.trim();
            
            if (!extractedText) {
                throw new Error('No readable text found in the image. Please ensure the image contains clear, readable text.');
            }
            
            // 显示预览
            previewText.textContent = extractedText;
            previewSection.style.display = 'block';
            
            updateProgress(100, 'Conversion completed successfully!');
            
            // 显示成功信息
            setTimeout(() => {
                progressSection.style.display = 'none';
                convertBtn.disabled = false;
                
                // 滚动到预览区域
                previewSection.scrollIntoView({ behavior: 'smooth' });
            }, 1500);
            
        } else {
            throw new Error('No text extracted from the image');
        }
        
    } catch (error) {
        console.error('Conversion error:', error);
        
        let errorMsg = error.message;
        
        // 提供具体的错误解决建议
        if (error.message.includes('Failed to fetch') || error.message.includes('network')) {
            errorMsg = 'Network connection failed. Please check your internet connection and try again.';
        } else if (error.message.includes('timeout')) {
            errorMsg = 'Request timeout. The image might be too complex. Try with a simpler image.';
        } else if (error.message.includes('No text found')) {
            errorMsg = 'No text detected in the image. Please ensure the image contains clear, readable text.';
        }
        
        showError(`Conversion failed: ${errorMsg}`);
        progressSection.style.display = 'none';
        convertBtn.disabled = false;
    }
}

// 改进语言映射
function getTesseractLanguage(code) {
    const languageMap = {
        'eng': 'eng',
        'chi_sim': 'chi_sim',
        'chi_tra': 'chi_tra',
        'hin': 'hin',
        'spa': 'spa',
        'ben': 'ben',
        'por': 'por',
        'rus': 'rus',
        'jpn': 'jpn'
    };
    return languageMap[code] || 'eng';
}

// 添加更好的文件验证
function validateImageFile(file) {
    const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/bmp', 'image/tiff', 'image/webp'];
    const maxSize = 10 * 1024 * 1024; // 10MB
    
    if (!validTypes.includes(file.type.toLowerCase())) {
        throw new Error('Unsupported file type. Please use JPG, PNG, BMP, TIFF, or WebP images.');
    }
    
    if (file.size > maxSize) {
        throw new Error('File too large. Please use an image smaller than 10MB.');
    }
    
    if (file.size < 1024) { // 1KB
        throw new Error('File too small. Please select a valid image file.');
    }
    
    return true;
}

// 改进文件选择处理
function handleFileSelect(file) {
    hideError();
    
    try {
        validateImageFile(file);
        
        selectedFile = file;
        uploadArea.innerHTML = `
            <div class="upload-icon">✅</div>
            <h3>File Selected: ${file.name}</h3>
            <p>Size: ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
            <p>Type: ${file.type}</p>
            <p>Click "Convert to Word" to start processing</p>
        `;
        convertBtn.style.display = 'inline-block';
        
        // 隐藏之前的结果
        previewSection.style.display = 'none';
        
    } catch (error) {
        showError(error.message);
        selectedFile = null;
        convertBtn.style.display = 'none';
    }
}

// Tesseract.js语言码映射
function getTesseractLanguage(code) {
    const languageMap = {
        'eng': 'eng',
        'chi_sim': 'chi_sim',
        'chi_tra': 'chi_tra',
        'hin': 'hin',
        'spa': 'spa',
        'ben': 'ben',
        'por': 'por',
        'rus': 'rus',
        'jpn': 'jpn'
    };
    return languageMap[code] || 'eng';
}

// 改进的错误处理
async function convertImageToWord() {
    try {
        convertBtn.disabled = true;
        progressSection.style.display = 'block';
        hideError();
        
        updateProgress(10, 'Preparing image...');
        
        const base64Image = await fileToBase64(selectedFile);
        
        updateProgress(30, 'Processing with OCR...');
        
        // 添加超时处理
        const timeoutPromise = new Promise((_, reject) =>
            setTimeout(() => reject(new Error('Request timeout - please try again')), 30000)
        );
        
        const ocrResult = await Promise.race([
            performOCR(base64Image),
            timeoutPromise
        ]);
        
        updateProgress(70, 'Processing extracted text...');
        
        if (ocrResult && ocrResult.text) {
            extractedText = ocrResult.text.trim();
            
            if (!extractedText) {
                throw new Error('No readable text found in the image. Please ensure the image contains clear, readable text.');
            }
            
            previewText.textContent = extractedText;
            previewSection.style.display = 'block';
            
            updateProgress(100, 'Conversion completed!');
            
            setTimeout(() => {
                progressSection.style.display = 'none';
                convertBtn.disabled = false;
            }, 1000);
        } else {
            throw new Error('No text extracted from the image');
        }
        
    } catch (error) {
        console.error('Conversion error:', error);
        
        let errorMsg = error.message;
        if (error.message.includes('Failed to fetch')) {
            errorMsg = 'Connection failed. Please check your internet connection and try again.';
        }
        
        showError(`Conversion failed: ${errorMsg}`);
        progressSection.style.display = 'none';
        convertBtn.disabled = false;
    }
}
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        downloadBtn.addEventListener('click', () => {
            if (!extractedText) {
                showError('No text available to download');
                return;
            }
            
            generateWordDocument();
        });

        function generateWordDocument() {
            try {
                // Create a new document
                const doc = new docx.Document({
                    sections: [{
                        properties: {},
                        children: [
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: "Extracted Text from Image",
                                        bold: true,
                                        size: 28,
                                    }),
                                ],
                                spacing: {
                                    after: 200,
                                },
                            }),
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: `Source: ${selectedFile.name}`,
                                        italics: true,
                                    }),
                                ],
                                spacing: {
                                    after: 200,
                                },
                            }),
                            new docx.Paragraph({
                                children: [
                                    new docx.TextRun({
                                        text: `Language: ${getLanguageName(languageSelect.value)}`,
                                        italics: true,
                                    }),
                                ],
                                spacing: {
                                    after: 400,
                                },
                            }),
                            ...extractedText.split('\n').map(line => 
                                new docx.Paragraph({
                                    children: [
                                        new docx.TextRun({
                                            text: line || ' ', // Empty line fallback
                                        }),
                                    ],
                                    spacing: {
                                        after: 120,
                                    },
                                })
                            ),
                        ],
                    }],
                });

                // Generate and download the document
                docx.Packer.toBlob(doc).then(blob => {
                    const fileName = `${selectedFile.name.split('.')[0]}_extracted_text.docx`;
                    saveAs(blob, fileName);
                });
                
            } catch (error) {
                console.error('Word generation error:', error);
                showError('Failed to generate Word document');
            }
        }

        function getOCRSpaceLanguage(code) {
            // OCR.space language codes mapping
            const languageMap = {
                'auto': 'eng', // OCR.space doesn't have auto-detect, default to English
                'eng': 'eng',
                'chi_sim': 'chs', // Chinese Simplified
                'chi_tra': 'cht', // Chinese Traditional
                'hin': 'hin',
                'spa': 'spa',
                'ben': 'ben',
                'por': 'por',
                'rus': 'rus',
                'jpn': 'jpn'
            };
            return languageMap[code] || 'eng';
        }

        function getLanguageName(code) {
            const languages = {
                'auto': 'Auto Detect',
                'eng': 'English',
                'chi_sim': 'Chinese (Simplified)',
                'chi_tra': 'Chinese (Traditional)',
                'hin': 'Hindi',
                'spa': 'Spanish',
                'ben': 'Bengali',
                'por': 'Portuguese',
                'rus': 'Russian',
                'jpn': 'Japanese'
            };
            return languages[code] || code;
        }

        function updateProgress(percentage, text) {
            progressFill.style.width = percentage + '%';
            progressText.textContent = text;
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>